// gcc rle_native.c -o rle_test

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <string.h>

#define RED "\e[0;31m"
#define GREEN "\e[0;32m"
#define WHITE "\e[0;37m"

uint16_t rle_decompress(uint8_t *dest, uint16_t max_bytes, uint8_t *compressed,
                        uint8_t byte_len, uint16_t bit_index) {
  uint16_t count = 0;
  uint8_t bit_offset = bit_index % 8;
  for (uint8_t d = 0; d < byte_len; d++) {

    uint8_t bits = compressed[d];
    bool zeros = bits < 128;
    if (!zeros) {
      bits -= 128;
      //printf("1:%d, ", bits);
    } 
    // else {
    //   printf("0:%d, ", bits);
    // }
    for (uint8_t b = 0; b < bits; b++) {
      if (count / 8 >= max_bytes) {
        return count;
      }
      if (zeros) {
        *dest &= ~(1 << (7 - bit_offset));
      } else {
        *dest |= (1 << (7 - bit_offset));
      }
      count++;
      bit_offset++;
      if (bit_offset == 8) {
        //printf("-> 0x%02x (%d->)", *dest, bits - b - 1);
        dest++;
        bit_offset = 0;
      }
    }
  }
  return count;
}

void rle_test() {
  printf("\n***** Starting RLE Test:\n");

  uint8_t original[] = {
      0x85, 0x9a, 0x27, 0xcb, 0xd7, 0xa3, 0xae, 0xfd, 0x2c, 0xcc, 0x45, 0x49,
      0xe1, 0xb3, 0x8a, 0xc3, 0x11, 0xf8, 0xac, 0x1c, 0xf0, 0xbf, 0xcd, 0xcf,
      0x89, 0x4b, 0xae, 0xfa, 0x71, 0x78, 0xcd, 0x55, 0x48, 0x9c, 0xf1, 0x2a,
      0x67, 0x4e, 0x72, 0x59, 0x3a, 0x8f, 0x8a, 0x1a, 0x05, 0x62, 0xac, 0x98,
      0xc7, 0x86, 0x5a, 0x8c, 0xbd, 0xa2, 0x0b, 0xe5, 0xa1, 0xd1, 0x98, 0xbb};
  uint8_t test_result[sizeof(original)];
  uint8_t compressed[] = {
      0x00, 0x81, 0x04, 0x81, 0x01, 0x82, 0x02, 0x82, 0x01, 0x81, 0x03, 0x81,
      0x02, 0x85, 0x02, 0x81, 0x01, 0x84, 0x01, 0x81, 0x01, 0x84, 0x01, 0x81,
      0x03, 0x83, 0x01, 0x81, 0x01, 0x83, 0x01, 0x86, 0x01, 0x81, 0x02, 0x81,
      0x01, 0x82, 0x02, 0x82, 0x02, 0x82, 0x03, 0x81, 0x03, 0x81, 0x01, 0x81,
      0x01, 0x81, 0x02, 0x81, 0x02, 0x84, 0x04, 0x82, 0x01, 0x82, 0x02, 0x83,
      0x03, 0x81, 0x01, 0x81, 0x01, 0x82, 0x04, 0x82, 0x03, 0x81, 0x03, 0x86,
      0x03, 0x81, 0x01, 0x81, 0x01, 0x82, 0x05, 0x83, 0x02, 0x84, 0x04, 0x81,
      0x01, 0x88, 0x02, 0x82, 0x01, 0x83, 0x02, 0x85, 0x03, 0x81, 0x02, 0x81,
      0x01, 0x81, 0x02, 0x81, 0x01, 0x83, 0x01, 0x81, 0x01, 0x83, 0x01, 0x85,
      0x01, 0x81, 0x02, 0x83, 0x03, 0x81, 0x01, 0x84, 0x03, 0x82, 0x02, 0x82,
      0x01, 0x81, 0x01, 0x81, 0x01, 0x81, 0x01, 0x81, 0x01, 0x81, 0x01, 0x81,
      0x02, 0x81, 0x03, 0x81, 0x02, 0x83, 0x02, 0x84, 0x03, 0x81, 0x02, 0x81,
      0x01, 0x81, 0x01, 0x81, 0x02, 0x82, 0x02, 0x83, 0x01, 0x81, 0x02, 0x83,
      0x02, 0x83, 0x02, 0x81, 0x02, 0x81, 0x01, 0x82, 0x02, 0x81, 0x02, 0x83,
      0x01, 0x81, 0x01, 0x81, 0x03, 0x85, 0x03, 0x81, 0x01, 0x81, 0x04, 0x82,
      0x01, 0x81, 0x06, 0x81, 0x01, 0x81, 0x01, 0x82, 0x03, 0x81, 0x01, 0x81,
      0x01, 0x81, 0x01, 0x82, 0x02, 0x81, 0x02, 0x82, 0x03, 0x82, 0x03, 0x84,
      0x04, 0x82, 0x02, 0x81, 0x01, 0x82, 0x01, 0x81, 0x01, 0x81, 0x03, 0x82,
      0x02, 0x81, 0x01, 0x84, 0x01, 0x82, 0x01, 0x81, 0x03, 0x81, 0x05, 0x81,
      0x01, 0x85, 0x02, 0x81, 0x01, 0x82, 0x01, 0x81, 0x04, 0x83, 0x01, 0x81,
      0x03, 0x82, 0x02, 0x82, 0x03, 0x81, 0x01, 0x83, 0x01, 0x82};
  uint16_t num_bits = rle_decompress(test_result, sizeof(test_result),
                                     compressed, sizeof(compressed), 0);

  bool success = true;
  printf("Original (%ld):\n", sizeof(original));
  for (uint16_t idx = 0; idx < sizeof(original); idx++) {
    printf("0x%02x,", original[idx]);
  }

  printf("\nDecompressed (%d, %d bits):\n", num_bits / 8, num_bits);
  for (uint16_t idx = 0; idx < sizeof(test_result); idx++) {
    printf("0x%02x,", test_result[idx]);
    if (test_result[idx] != original[idx]) {
      success = false;
    }
  }
  if (success) {
    printf(GREEN "\nSUCCESS!" WHITE);
  } else {
    printf(RED "\nFAILED!" WHITE);
  }
}

#define SCREEN_WIDTH 72

// dest*
// |
// V
// +-----------SCREEN_WIDTH-------------+
// |                                    |
// |             +--------w---------+   |
// |             |(x,y)             |   |
// |             |                  |   |
// |             h   bit_index@@@@@@|   | (bit_index = last bit index that was copied + 1)
// |             |@@@@@@@@@@@@len   |   |
// |             |                  |   |
// |             +------------------+   |
// |                                    |
// +------------------------------------+
//
// +--------w---------+
// |(x,y)             |
// |                  |
// h   <-data*@@@@@@@@|
// |@@@@@@@@@@@@len   | (len in num of bits)
// |                  |
// +------------------+

uint16_t copy_rectangle_to_overlay(uint8_t *dest, uint8_t *data, uint8_t x,
                                   uint8_t y, uint8_t w, uint8_t h,
                                   uint16_t *bit_idx, uint16_t bitlen) {
  uint16_t bit_cnt = 0;
  uint8_t start_y = *bit_idx / SCREEN_WIDTH;
  uint8_t stop_y = y + h;
  for (uint8_t dest_y = start_y; dest_y < stop_y; dest_y++) {
    uint8_t start_x = bit_cnt == 0 ? *bit_idx % SCREEN_WIDTH : x;
    
    uint8_t stop_x = x + w;
    if (start_x == stop_x) {
      start_x = x;
      dest_y++;
      if (dest_y >= stop_y) {
        return bit_cnt;
      }
    } else if(start_x<x) {
      start_x = x;
    }
    for (uint8_t dest_x = start_x; dest_x < stop_x; dest_x++) {
      *bit_idx = dest_y * SCREEN_WIDTH + dest_x;
      uint8_t data_byte = data[bit_cnt / 8];
      uint8_t bit_in_byte = bit_cnt % 8;
      bool bit_is_set = ((0x80 >> bit_in_byte) & data_byte) != 0;

      if (bit_is_set) {
        dest[(*bit_idx) / 8] |= 0x80 >> (*bit_idx % 8);
      } else {
        dest[(*bit_idx) / 8] &= ~(0x80 >> (*bit_idx % 8));
      }

      bit_cnt++;
      if (bit_cnt >= bitlen) {
        *bit_idx = *bit_idx + 1;
        return bit_cnt;
      }
    }
  }
  *bit_idx = *bit_idx + 1;
  return bit_cnt;
}

uint16_t copy_compressed_rectangle_to_overlay(uint8_t *dest,
                                              uint8_t *compressed, uint8_t x,
                                              uint8_t y, uint8_t w, uint8_t h,
                                              uint16_t *bit_index,
                                              uint16_t bitlen) {

  uint16_t copied_bits = 0;
  //uint16_t hid_bit_index = y * SCREEN_WIDTH + x;

  for (uint8_t i = 0; i < bitlen / 8; i++) {
    uint8_t buffer[16];
    uint16_t num_bits = rle_decompress(buffer, 16, &compressed[i], 1, 0);

    uint16_t copied = copy_rectangle_to_overlay(dest, buffer, x, y, w, h,
                                                bit_index, num_bits);
    copied_bits += copied;
  }

  return copied_bits;
}

uint16_t min(uint16_t a, uint16_t b) {
  if (a < b) {
    return a;
  }
  return b;
}

void print_bin(uint8_t *buffer, uint8_t max_x, uint8_t max_y) {
  for (uint8_t x = 0; x < max_x; x++) {
    if (x % 10 == 0) {
      printf("%x", x / 10);
    } else {
      printf("-");
    }
  }
  printf("\n");
  uint32_t cnt = 0;
  for (uint8_t y = 0; y < max_y; y++) {
    for (uint8_t x = 0; x < max_x; x++) {
      printf("%d", ((buffer[cnt / 8] & (0x80 >> (cnt % 8))) == 0) ? 0 : 1);
      cnt++;
    }
    if (y % 10 == 0) {
      printf(" %x\n", y / 10);
    } else {
      printf("\n");
    }
  }
}

void run_roi_test(uint8_t text_idx, uint16_t chunk_size, uint8_t *all,
                  uint8_t *roi, uint16_t roi_size, uint8_t *croi,
                  uint16_t croi_size, uint8_t roi_x, uint8_t roi_y,
                  uint8_t roi_xx, uint8_t roi_yy) {
  uint8_t dest[360];
  memset(&dest, 0, sizeof(dest));

  uint16_t copied_bits = 0;
  uint16_t hid_bit_index = roi_y * SCREEN_WIDTH + roi_x;
  printf("\n***** Starting ROI Test %d, %d byte chunks (first byte %d, x: %d "
         "y: %d xx: %d yy: %d): ",
         text_idx, chunk_size, hid_bit_index / 8, roi_x, roi_y, roi_xx, roi_yy);

  for (int i = 0; i < roi_size / chunk_size + 1; i++) {
    uint16_t bit_len = min(chunk_size * 8, roi_size * 8 - copied_bits);
    uint16_t copied = copy_rectangle_to_overlay(
        dest, &roi[i * chunk_size], roi_x, roi_y, roi_xx - roi_x,
        roi_yy - roi_y, &hid_bit_index, bit_len);
    copied_bits += copied;
  }

  bool success = true;
  for (int i = 0; i < sizeof(dest); i++) {
    if (dest[i] != all[i]) {
      success = false;
    }
  }
  if (success) {
    printf(GREEN "SUCCESS!" WHITE);
  } else {
    printf(RED "FAILED!" WHITE);


    printf("\nOriginal:\n");
    print_bin(all, 72, 40);
  
    printf("\nComposed:\n");
    print_bin(dest, 72, 40);
  
    printf("\nRoi: (x: %d y: %d xx: %d yy: %d):\n", roi_x, roi_y, roi_xx, roi_yy);
    print_bin(roi, roi_xx - roi_x, roi_yy - roi_y);
  }

  if(croi) {
    printf("\n***** Starting Compressed ROI Test %d, %d byte chunks (first byte %d, x: %d "
         "y: %d xx: %d yy: %d): ",
         text_idx, chunk_size, hid_bit_index / 8, roi_x, roi_y, roi_xx, roi_yy);

    memset(&dest, 0, sizeof(dest));

    uint16_t decompressed_bits = 0;
    hid_bit_index = roi_y * SCREEN_WIDTH + roi_x;

    for (int i = 0; i < croi_size / chunk_size + 1; i++) {
      uint16_t bit_len = min(chunk_size * 8, croi_size * 8 - i*8);
      uint16_t bits = copy_compressed_rectangle_to_overlay(
          dest, &croi[i * chunk_size], roi_x, roi_y, roi_xx - roi_x,
          roi_yy - roi_y, &hid_bit_index, bit_len);
      decompressed_bits += bits;
    }

    success = true;
    for (int i = 0; i < sizeof(dest); i++) {
      if (dest[i] != all[i]) {
        success = false;
      }
    }
    if (success) {
      printf(GREEN "SUCCESS!" WHITE);
    } else {
      printf(RED "FAILED!" WHITE);


      printf("\nOriginal:\n");
      print_bin(all, 72, 40);
    
      printf("\nComposed:\n");
      print_bin(dest, 72, 40);
    }
  }
}

void run_roi_tests(uint8_t text_idx, uint8_t *all,
  uint8_t *roi, uint16_t roi_size, uint8_t *croi,
  uint16_t croi_size, uint8_t roi_x, uint8_t roi_y,
  uint8_t roi_xx, uint8_t roi_yy) {

    for(uint8_t chunk_size=7;chunk_size<66;chunk_size++) {
      run_roi_test(text_idx, chunk_size, all, roi, roi_size, croi, croi_size, roi_x, roi_y, roi_xx, roi_yy);
    }
}


void roi_test_0() {
  uint8_t all[] = {
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xf1, 0xff, 0xe0, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x1,  0xf1, 0xff, 0xf8, 0x0,  0x0,  0x0,  0x0,  0x0,  0x1,
      0xf1, 0xff, 0xfc, 0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xf1, 0xff, 0xfc,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xf1, 0xf0, 0x7e, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x1,  0xf1, 0xf0, 0x3e, 0x0,  0x0,  0x0,  0x0,  0x0,  0x1,
      0xf1, 0xf0, 0x3e, 0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xf1, 0xf0, 0x7c,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xf1, 0xff, 0xfc, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x1,  0xf1, 0xff, 0xf8, 0x0,  0x0,  0x0,  0x0,  0x0,  0x1,
      0xf1, 0xff, 0xfc, 0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xf1, 0xff, 0xfe,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xf1, 0xf0, 0x3f, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x1,  0xf1, 0xf0, 0x1f, 0x0,  0x0,  0x0,  0x0,  0x0,  0xc3,
      0xf1, 0xf0, 0x1f, 0x0,  0x0,  0x0,  0x0,  0x1,  0xf7, 0xe1, 0xf0, 0x3f,
      0x0,  0x0,  0x0,  0x0,  0x3,  0xff, 0xe1, 0xff, 0xfe, 0x0,  0x0,  0x0,
      0x0,  0x1,  0xff, 0xc1, 0xff, 0xfe, 0x0,  0x0,  0x0,  0x0,  0x0,  0xff,
      0x81, 0xff, 0xf8, 0x0,  0x0,  0x0,  0x0,  0x0,  0x7e, 0x1,  0xff, 0xe0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0xff, 0xff, 0xe0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xff,
      0xff, 0xe0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xff, 0xff, 0xe0, 0x0};
  uint8_t roi_y = 8, roi_x = 38, roi_yy = 40, roi_xx = 72;
  uint8_t roi[] = {
      0x0,  0x7c, 0x7f, 0xf8, 0x0,  0x1f, 0x1f, 0xff, 0x80, 0x7,  0xc7, 0xff,
      0xf0, 0x1,  0xf1, 0xff, 0xfc, 0x0,  0x7c, 0x7c, 0x1f, 0x80, 0x1f, 0x1f,
      0x3,  0xe0, 0x7,  0xc7, 0xc0, 0xf8, 0x1,  0xf1, 0xf0, 0x7c, 0x0,  0x7c,
      0x7f, 0xff, 0x0,  0x1f, 0x1f, 0xff, 0x80, 0x7,  0xc7, 0xff, 0xf0, 0x1,
      0xf1, 0xff, 0xfe, 0x0,  0x7c, 0x7c, 0xf,  0xc0, 0x1f, 0x1f, 0x1,  0xf3,
      0xf,  0xc7, 0xc0, 0x7d, 0xf7, 0xe1, 0xf0, 0x3f, 0xff, 0xf8, 0x7f, 0xff,
      0x9f, 0xfc, 0x1f, 0xff, 0xe3, 0xfe, 0x7,  0xff, 0xe0, 0x7e, 0x1,  0xff,
      0xe0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0xf,  0xff, 0xfe, 0x0,  0x3,  0xff, 0xff, 0x80, 0x0,
      0xff, 0xff, 0xe0, 0x0};
  uint8_t croi[] = {
      0x9, 0x85, 0x3,  0x8c, 0xe,  0x85, 0x3, 0x8e, 0xc, 0x85, 0x3, 0x8f,
      0xb, 0x85, 0x3,  0x8f, 0xb,  0x85, 0x3, 0x85, 0x5, 0x86, 0xa, 0x85,
      0x3, 0x85, 0x6,  0x85, 0xa,  0x85, 0x3, 0x85, 0x6, 0x85, 0xa, 0x85,
      0x3, 0x85, 0x5,  0x85, 0xb,  0x85, 0x3, 0x8f, 0xb, 0x85, 0x3, 0x8e,
      0xc, 0x85, 0x3,  0x8f, 0xb,  0x85, 0x3, 0x90, 0xa, 0x85, 0x3, 0x85,
      0x6, 0x86, 0x9,  0x85, 0x3,  0x85, 0x7, 0x85, 0x2, 0x82, 0x4, 0x86,
      0x3, 0x85, 0x7,  0x85, 0x1,  0x85, 0x1, 0x86, 0x4, 0x85, 0x6, 0x93,
      0x4, 0x90, 0x2,  0x8b, 0x5,  0x90, 0x3, 0x89, 0x6, 0x8e, 0x6, 0x86,
      0x8, 0x8c, 0x7f, 0x7f, 0x3b, 0x93, 0xf, 0x93, 0xf, 0x93, 0xd};

  run_roi_tests(0, all, roi, sizeof(roi), croi, sizeof(croi), roi_x, roi_y,
               roi_xx, roi_yy);
}

void roi_test_1() {
  uint8_t all[] = {
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x38, 0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xff, 0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x1,  0xff, 0x80, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x3,  0xff, 0x80, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x3,  0xe1, 0xc0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x3,  0xc0, 0xc0, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x7,  0xc0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x7,  0xc0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xf,  0xc0, 0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xf,  0xe0, 0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x1f, 0xe0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x3f, 0xf0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x7,  0xff, 0xfe, 0x18,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x7,  0xff, 0xff, 0xf8, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x7,  0xff, 0xff, 0xf8, 0x0,  0x0,  0x0,  0x0,  0x0,  0x7,
      0xff, 0xff, 0xf8, 0x0,  0x0,  0x0,  0x0,  0x0,  0x7,  0xff, 0xff, 0xf8,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x7,  0xff, 0xff, 0xf8, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x7,  0xff, 0xff, 0xf8, 0x0,  0x0,  0x0,  0x0,  0x0,  0x7,
      0xff, 0xff, 0xf8, 0x0,  0x0,  0x0,  0x0,  0x0,  0x7,  0xff, 0xff, 0xf8,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x7,  0xff, 0xff, 0xf8, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0};
  uint8_t roi_y = 15, roi_x = 45, roi_yy = 37, roi_xx = 69;
  uint8_t roi[] = {0x0,  0x7,  0x0,  0x0,  0x1f, 0xe0, 0x0,  0x3f, 0xf0, 0x0,
                   0x7f, 0xf0, 0x0,  0x7c, 0x38, 0x0,  0x78, 0x18, 0x0,  0xf8,
                   0x0,  0x0,  0xf8, 0x0,  0x1,  0xf8, 0x0,  0x1,  0xfc, 0x0,
                   0x3,  0xfc, 0x0,  0x7,  0xfe, 0x0,  0xff, 0xff, 0xc3, 0xff,
                   0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                   0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                   0xff, 0xff, 0xff, 0xff, 0xff, 0xff};
  uint8_t croi[] = {0xd,  0x83, 0x13, 0x88, 0xf,  0x8a, 0xd,  0x8b, 0xd,
                    0x85, 0x4,  0x83, 0xc,  0x84, 0x6,  0x82, 0xb,  0x85,
                    0x13, 0x85, 0x12, 0x86, 0x12, 0x87, 0x10, 0x88, 0xf,
                    0x8a, 0x9,  0x92, 0x4,  0xff, 0xdb};

  run_roi_tests(1, all, roi, sizeof(roi), croi, sizeof(croi), roi_x, roi_y,
               roi_xx, roi_yy);
}

void roi_test_2() {
  uint8_t all[] = {
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x4,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0xe,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1f, 0x9c,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x3f, 0xf8, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x70, 0xf0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0xe0, 0x30, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xc0, 0x38,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x3,  0x80, 0x18, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x1,  0xc0, 0x18, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0xe0, 0x18, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x70, 0x18,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x38, 0x38, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x18, 0x1c, 0x70, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x38, 0xe,  0xe0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x3,  0x70, 0x7,  0xc0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x7,  0xe0, 0x3,  0x80, 0x0,  0x0,  0x0,
      0x0,  0x0,  0xf,  0xe0, 0x1,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1c,
      0xe0, 0x40, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x18, 0x70, 0xe0, 0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x38, 0x39, 0xc0, 0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x30, 0x1f, 0x80, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x30,
      0xf,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x30, 0x7,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x30, 0x3,  0x80, 0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x38, 0x7,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1c,
      0xe,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1e, 0x3c, 0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x3f, 0xf8, 0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x73, 0xe0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x60,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0};
  uint8_t roi_y = 9, roi_x = 41, roi_yy = 39, roi_xx = 71;
  uint8_t roi[] = {
      0x0,  0x0,  0x0,  0x8,  0x0,  0x0,  0x0,  0x70, 0x0,  0x3,  0xf3, 0x80,
      0x0,  0x1f, 0xfc, 0x0,  0x0,  0xe1, 0xe0, 0x0,  0x7,  0x1,  0x80, 0x0,
      0x38, 0x7,  0x0,  0x1,  0xc0, 0xc,  0x0,  0x3,  0x80, 0x30, 0x0,  0x7,
      0x0,  0xc0, 0x0,  0xe,  0x3,  0x0,  0x0,  0x1c, 0x1c, 0x0,  0x30, 0x38,
      0xe0, 0x1,  0xc0, 0x77, 0x0,  0x6e, 0x0,  0xf8, 0x3,  0xf0, 0x1,  0xc0,
      0x1f, 0xc0, 0x2,  0x0,  0xe7, 0x2,  0x0,  0x3,  0xe,  0x1c, 0x0,  0x1c,
      0x1c, 0xe0, 0x0,  0x60, 0x3f, 0x0,  0x1,  0x80, 0x78, 0x0,  0x6,  0x0,
      0xe0, 0x0,  0x18, 0x1,  0xc0, 0x0,  0x70, 0xe,  0x0,  0x0,  0xe0, 0x70,
      0x0,  0x3,  0xc7, 0x80, 0x0,  0x1f, 0xfc, 0x0,  0x0,  0xe7, 0xc0, 0x0,
      0x3,  0x0,  0x0,  0x0,  0x0};
  uint8_t croi[] = {
      0x1c, 0x81, 0x1c, 0x83, 0x12, 0x86, 0x2,  0x83, 0x12, 0x8b, 0x12, 0x83,
      0x4,  0x84, 0x12, 0x83, 0x7,  0x82, 0x11, 0x83, 0x8,  0x83, 0xf,  0x83,
      0xa,  0x82, 0x10, 0x83, 0x9,  0x82, 0x11, 0x83, 0x8,  0x82, 0x12, 0x83,
      0x7,  0x82, 0x13, 0x83, 0x5,  0x83, 0xc,  0x82, 0x6,  0x83, 0x3,  0x83,
      0xc,  0x83, 0x7,  0x83, 0x1,  0x83, 0x9,  0x82, 0x1,  0x83, 0x9,  0x85,
      0x9,  0x86, 0xb,  0x83, 0x9,  0x87, 0xc,  0x81, 0x9,  0x83, 0x2,  0x83,
      0x6,  0x81, 0xf,  0x82, 0x4,  0x83, 0x4,  0x83, 0xd,  0x83, 0x5,  0x83,
      0x2,  0x83, 0xe,  0x82, 0x7,  0x86, 0xf,  0x82, 0x8,  0x84, 0x10, 0x82,
      0x9,  0x83, 0x10, 0x82, 0xa,  0x83, 0xf,  0x83, 0x8,  0x83, 0x11, 0x83,
      0x6,  0x83, 0x12, 0x84, 0x3,  0x84, 0x12, 0x8b, 0x12, 0x83, 0x2,  0x85,
      0x14, 0x82, 0x20};

  run_roi_tests(2, all, roi, sizeof(roi), croi, sizeof(croi), roi_x, roi_y,
               roi_xx, roi_yy);
}

void roi_test_3() {
  uint8_t all[] = {
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x7,  0xfe, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1f, 0xff, 0x80,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x3f, 0x9f, 0xc0, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x7c, 0x3,  0xe0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0xf0, 0x0,  0xf0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xe0, 0x80, 0x78,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xc1, 0xc0, 0x38, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x3,  0xc3, 0xc0, 0x3c, 0x0,  0x0,  0x0,  0x0,  0x0,  0x3,
      0x87, 0x80, 0x1c, 0x0,  0x0,  0x0,  0x0,  0x0,  0x3,  0x8f, 0x0,  0x1c,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x3,  0x9e, 0x0,  0x1c, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x3,  0x3f, 0xff, 0xcc, 0x0,  0x0,  0x0,  0x0,  0x0,  0x3,
      0x3f, 0xff, 0xcc, 0x0,  0x0,  0x0,  0x0,  0x0,  0x3,  0x9e, 0x0,  0x1c,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x3,  0x8f, 0x0,  0x1c, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x3,  0x87, 0x80, 0x1c, 0x0,  0x0,  0x0,  0x0,  0x0,  0x3,
      0xc3, 0xc0, 0x3c, 0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xc1, 0xc0, 0x38,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xe0, 0x80, 0x78, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0xf0, 0x0,  0xf0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x7c, 0x3,  0xe0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x3f, 0x9f, 0xc0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1f, 0xff, 0x80, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x7,  0xfe, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0};
  uint8_t roi_y = 14, roi_x = 46, roi_yy = 38, roi_xx = 70;
  uint8_t roi[] = {
      0x1,  0xff, 0x80, 0x7,  0xff, 0xe0, 0xf,  0xe7, 0xf0, 0x1f, 0x0,  0xf8,
      0x3c, 0x0,  0x3c, 0x78, 0x20, 0x1e, 0x70, 0x70, 0xe,  0xf0, 0xf0, 0xf,
      0xe1, 0xe0, 0x7,  0xe3, 0xc0, 0x7,  0xe7, 0x80, 0x7,  0xcf, 0xff, 0xf3,
      0xcf, 0xff, 0xf3, 0xe7, 0x80, 0x7,  0xe3, 0xc0, 0x7,  0xe1, 0xe0, 0x7,
      0xf0, 0xf0, 0xf,  0x70, 0x70, 0xe,  0x78, 0x20, 0x1e, 0x3c, 0x0,  0x3c,
      0x1f, 0x0,  0xf8, 0xf,  0xe7, 0xf0, 0x7,  0xff, 0xe0, 0x1,  0xff, 0x80};
  uint8_t croi[] = {0x7, 0x8a, 0xc, 0x8e, 0x9, 0x87, 0x2, 0x87, 0x7, 0x85,
                    0x8, 0x85, 0x5, 0x84, 0xc, 0x84, 0x3, 0x84, 0x5, 0x81,
                    0x8, 0x84, 0x2, 0x83, 0x5, 0x83, 0x8, 0x83, 0x1, 0x84,
                    0x4, 0x84, 0x8, 0x87, 0x4, 0x84, 0xa, 0x86, 0x3, 0x84,
                    0xb, 0x86, 0x2, 0x84, 0xc, 0x85, 0x2, 0x90, 0x2, 0x84,
                    0x2, 0x90, 0x2, 0x85, 0x2, 0x84, 0xc, 0x86, 0x3, 0x84,
                    0xb, 0x86, 0x4, 0x84, 0xa, 0x87, 0x4, 0x84, 0x8, 0x84,
                    0x1, 0x83, 0x5, 0x83, 0x8, 0x83, 0x2, 0x84, 0x5, 0x81,
                    0x8, 0x84, 0x3, 0x84, 0xc, 0x84, 0x5, 0x85, 0x8, 0x85,
                    0x7, 0x87, 0x2, 0x87, 0x9, 0x8e, 0xc, 0x8a, 0x7};
  run_roi_tests(3, all, roi, sizeof(roi), croi, sizeof(croi), roi_x, roi_y,
               roi_xx, roi_yy);
}

void roi_test_4() {
  uint8_t all[] = {
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x3,  0xc0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1f, 0xf0, 0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x3f, 0xf8, 0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x78, 0x3c, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0xf0, 0xe,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xe0, 0xe,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xc0, 0x7,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x1,  0xc0, 0x7,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1,
      0xc0, 0x7,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xc0, 0x7,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xc0, 0x7,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0xe0, 0x6,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0xe0, 0xe,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x78, 0x1e, 0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x3f, 0xfe, 0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x1f, 0xff, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x7,  0xe3, 0x80, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xc0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xe0, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x70, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x38, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x10,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0};
  uint8_t roi_y = 0, roi_x = 0, roi_yy = 40, roi_xx = 72;
  uint8_t roi[] = {
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x3,  0xc0, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1f, 0xf0, 0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x3f, 0xf8, 0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x78, 0x3c, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0xf0, 0xe,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xe0, 0xe,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xc0, 0x7,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x1,  0xc0, 0x7,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1,
      0xc0, 0x7,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xc0, 0x7,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xc0, 0x7,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0xe0, 0x6,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0xe0, 0xe,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x78, 0x1e, 0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x3f, 0xfe, 0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x1f, 0xff, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x7,  0xe3, 0x80, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1,  0xc0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xe0, 0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x70, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x38, 0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x10,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
      0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0};
  uint8_t croi[] = {0x7,  0x84, 0xf,  0x89, 0xc,  0x8b, 0xa,  0x84, 0x5,  0x84,
                    0x8,  0x84, 0x8,  0x83, 0x7,  0x83, 0x9,  0x83, 0x7,  0x82,
                    0xb,  0x83, 0x5,  0x83, 0xb,  0x83, 0x5,  0x83, 0xb,  0x83,
                    0x5,  0x83, 0xb,  0x83, 0x5,  0x83, 0xb,  0x83, 0x6,  0x83,
                    0xa,  0x82, 0x7,  0x83, 0x9,  0x83, 0x8,  0x84, 0x6,  0x84,
                    0x9,  0x8d, 0xa,  0x8d, 0xb,  0x86, 0x3,  0x83, 0x14, 0x83,
                    0x14, 0x83, 0x14, 0x83, 0x14, 0x83, 0x14, 0x81, 0x5};
  run_roi_tests(4, all, roi, sizeof(roi), 0, 0, roi_x, roi_y,
               roi_xx, roi_yy);
}

void header_test_1() {
  printf("\n***** Starting ROI-Header Test 1: ");

  uint8_t top = 9, left = 3, bottom = 37, right = 71, mods = 2;
  bool rle = true;
  uint8_t header[] = {0x22, 0x95, 0x3, 0xc7};

  uint8_t r_mods = header[0] & 0x0f;
  uint8_t r_y = (header[1] & 0x03) | ((header[0] >> 2) & 0x3c);
  uint8_t r_yy = header[1] >> 2;
  uint8_t r_x = header[2];
  uint8_t r_xx = header[3] & 0x7f;
  bool r_rle = ((header[3] & 0x80) != 0);
  if (top == r_y && left == r_x && bottom == r_yy && right == r_xx &&
      mods == r_mods && rle == r_rle) {
    printf(GREEN "SUCCESS!" WHITE);
  } else {
    printf(RED "FAILED! Problem in header fields detected!" WHITE);
  }
}

void header_test_2() {
  printf("\n***** Starting ROI-Header Test 2: ");

  uint8_t top = 15, left = 56, bottom = 31, right = 69, mods = 5;
  bool rle = false;
  uint8_t header[] = {0x35, 0x7f, 0x38, 0x45};

  uint8_t r_mods = header[0] & 0x0f;
  uint8_t r_y = (header[1] & 0x03) | ((header[0] >> 2) & 0x3c);
  uint8_t r_yy = header[1] >> 2;
  uint8_t r_x = header[2];
  uint8_t r_xx = header[3] & 0x7f;
  bool r_rle = ((header[3] & 0x80) != 0);
  if (top == r_y && left == r_x && bottom == r_yy && right == r_xx &&
      mods == r_mods && rle == r_rle) {
    printf(GREEN "SUCCESS!" WHITE);
  } else {
    printf(RED "FAILED! Problem in header fields detected!" WHITE);
  }
}

int main() {
  rle_test();

  roi_test_0();
  roi_test_1();
  roi_test_2();
  roi_test_3();
  roi_test_4();

  header_test_1();
  header_test_2();

  printf("\nDone.\n");
  return 0;
}
